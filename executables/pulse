#!/usr/bin/env ruby
# encoding: utf-8

$:.unshift File.dirname(__FILE__) + '/../library'
require 'pulse'

Pulse::Queue::SleepDuration = 0

Pulse.connect hostname: 'irc.metabox.it', port: 6080, password: 'password', username: 'meta', nickname: 'pulse' do
  puts "=> Pulse #{Pulse::Version}"

  catch :connection_ready do
    puts "Connection ready …"
    puts

    @connection.transmit :JOIN, '#maero'
  end

  catch :message do |user, channel, line|
    if line.starts_with? '.test'
      1000.times &channel.method(:say)
    end
  end

  catch :user_joined do |user, channel|
    debug "#{user} has entered #{channel} …"
  end

  catch :user_left do |user, channel|
    debug "#{user} has left #{channel} …"
  end

  def debug message
    puts "#{Time.now.strftime "%H:%M:%S"} #{message}"
  end
end
